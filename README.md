## Дипломная работа по профессии "DevOps-инженер с нуля"
### Исполнитель: Давлат Файзиев
### Дипломный руководитель: Булат Замилов
---
Дипломное задание находится по [ссылке](https://github.com/netology-code/devops-diplom-yandexcloud)  

### Подготовка к выполнению:
Для выполения дипломной работы на рабочее место были установлены следующие приложения:  
| Наименование       | Версия       |
|--------------------|--------------|
| Ubuntu на WSL      | 22.04        | 
| Visual Studio Code | 1.96.4       | 
| Terraform          | v1.8.4       | 
| Kubespray          | release-2.27 | 
| Docker             | ver. 27.3.1  |

### Создание облачной инфраструктуры
1. Управление инфраструктурой будет осуществляться сервисным аккаунтом с правами "editor", стейт файл будет храниться S3 bucket.
Для создания аккаунта и бакета необходимо перейти в папку S3_bucket_SA и выполнить команды  `terraform init` и `terraform apply`.
![Скриншот 1](img/1.png)   
В результате выполнения кода создается сервисный аккаунт и S3 bucket.  
Чувствительные данные аккаунта сохранаются в файл `.auth-key.json`, данные доступа к бакету в файл `.credentials`.

2. Далее подготовим инфраструктуру для Kubernetes кластера. Инфраструктура состоит из 3-х ВМ в разных подсетях и в разных зонах доступа.
Характеристики всех ВМ будут одинаковыми:
- vCPU - 2
- RAM - 4 Гб
- disk - 20 Гб  
ВМ будут создаваться с использованием модуля `compute_instance`.  На ВМ будет создан пользователь и передан его публичный ключ при помощи cloud-config.  
Для поднятия инфраструктуры необходимо перейти в папку infra и выполнить команды  `terraform init` и `terraform apply`.  
В terraform коде будут использоваться данные аккаунта и бакета из пункта 1.  
![Скриншот 2](img/2.png)   
В результате выполнения кода создается сеть, подсети, ВМ и файл hosts.ini со следующим содержимым для создания Kubernetes кластера.  
![Скриншот 3](img/3.png)   

### Создание Kubernetes кластера
Для создания Kubernetes кластера используется Kubespray.  
В директории ansible выполним установку Kubespray в соответсвии с документацией. Переключимся на ветку release-2.27.  
Скопируем файл hosts.ini в папку inventory/mycluster. 
В переменную `supplementary_addresses_in_ssl_keys` в файле `inventory/mycluster/group_vars/k8s_cluster/k8s-cluster.yml` добавить внешний ip адрес master-nod-ы для внешнего доступа к кластеру.
Для запуска плейбука необходимо, перейти в папку kubespray выполнить команду:  
 `ansible-playbook -i inventory/mycluster/hosts.ini -u davlat -b -v --private-key=~/.ssh/yandxcld cluster.yml`  
![Скриншот 4](img/4.png)   
 Скопируем данные доступа к кластеру в файл ~/.kube/config на master-nod и на локальную машину.